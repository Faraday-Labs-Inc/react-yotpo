{"version":3,"file":"index.es.js","sources":["../src/utils/decodeProductId.ts","../src/hooks/useYotpoRefresh.ts","../src/utils/debounce.ts","../src/components/YotpoStarRating/YotpoStarRating.tsx","../src/components/YotpoReviews/YotpoReviews.tsx","../src/components/YotpoScripts/YotpoScripts.tsx"],"sourcesContent":["/**\r\n * Decodes a base64 Shopify product id\r\n *\r\n * @param productId the base64 product id\r\n *\r\n * @returns the decoded product id; if there is an error decoding the product id\r\n * or there is no product id, the function will return null\r\n */\r\nexport default function decodeProductId(productId: string): string {\r\n  if (!productId) {\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    return Buffer.from(productId, 'base64').toString('ascii').split('/').pop();\r\n  } catch (err) {\r\n    console.error(`Could not decode productId: ${productId}`, err.message);\r\n    return null;\r\n  }\r\n}\r\n","import { useEffect, useMemo } from 'react';\r\nimport debounce from '../utils/debounce';\r\n\r\ndeclare global {\r\n  interface Window {\r\n    yotpo?: {\r\n      refreshWidgets: Function;\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Forces Yotpo widgets to update when a React component mounts. This\r\n * refresh is debounced so that it does not repeatedly occur.\r\n *\r\n * @param debounceTime the amount of time (in milliseconds) the refresh\r\n *  call should be debounced. The default time is 200 milliseconds\r\n *\r\n * @returns undefined\r\n */\r\nexport function useYotpoRefresh(debounceTime: number = 200): void {\r\n  const debouncedRefresh = useMemo(() => {\r\n    const refreshWidgets = window.yotpo\r\n      ? window.yotpo.refreshWidgets.bind(window.yotpo)\r\n      : () => {};\r\n\r\n    return debounce(refreshWidgets, debounceTime);\r\n  }, [debounceTime]);\r\n\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined' && window.yotpo) {\r\n      debouncedRefresh();\r\n    }\r\n  }, [debouncedRefresh]);\r\n}\r\n","/**\r\n * Returns a function, that, as long as it continues to be invoked, will not\r\n * be triggered. The function will be called after it stops being called for\r\n * N milliseconds. If `immediate` is passed, trigger the function on the\r\n * leading edge, instead of the trailing.\r\n *\r\n * @param func the function to delay\r\n * @param wait the number of milliseconds to delay the function call\r\n * @param immediate a boolean indicating if the function should be called\r\n * immediately\r\n *\r\n * @returns a function that will be debounced when it is invoked\r\n */\r\nexport default function debounce(\r\n  func: Function,\r\n  wait: number,\r\n  immediate?: boolean\r\n): (...args: unknown[]) => void {\r\n  let timeout: ReturnType<typeof setTimeout>;\r\n\r\n  return function (...args: unknown[]): void {\r\n    const context = this;\r\n\r\n    const later = function () {\r\n      timeout = null;\r\n      if (!immediate) {\r\n        func.apply(context, args);\r\n      }\r\n    };\r\n\r\n    const callNow = immediate && !timeout;\r\n\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n\r\n    if (callNow) {\r\n      func.apply(context, args);\r\n    }\r\n  };\r\n}\r\n","import React, { FC, useMemo } from 'react';\r\n\r\nimport decodeProductId from '../../utils/decodeProductId';\r\nimport { useYotpoRefresh } from '../../hooks/useYotpoRefresh';\r\n\r\nexport type YotpoStarRatingProps = {\r\n  productId: string;\r\n};\r\n\r\n/**\r\n * Adds a div to the dom for Yotpo to embed product ratings.\r\n *\r\n * Note that the productId provided to this component should\r\n * be the Shopify base64 product id.\r\n */\r\nconst YotpoStarRating: FC<YotpoStarRatingProps> = ({ productId }) => {\r\n  useYotpoRefresh();\r\n\r\n  const sourceProductId = useMemo(() => decodeProductId(productId), [\r\n    productId\r\n  ]);\r\n\r\n  return <div className=\"yotpo bottomLine\" data-product-id={sourceProductId} />;\r\n};\r\n\r\nexport default YotpoStarRating;\r\n","import React, { FC, useMemo } from 'react';\r\nimport { Product } from '../../types/Types';\r\n\r\nimport decodeProductId from '../../utils/decodeProductId';\r\nimport { useYotpoRefresh } from '../../hooks/useYotpoRefresh';\r\n\r\nexport type YotpoReviewsProps = {\r\n  product: Product;\r\n  price: string;\r\n  urlPath: string;\r\n};\r\n\r\n/**\r\n * Adds a div to the DOM for Yotpo to embed reviews\r\n */\r\nconst YotpoReviews: FC<YotpoReviewsProps> = ({\r\n  product,\r\n  price = '',\r\n  urlPath = ''\r\n}) => {\r\n  useYotpoRefresh();\r\n\r\n  const sourceProductId = useMemo(\r\n    () => decodeProductId(product.id.toString()),\r\n    [product.id]\r\n  );\r\n\r\n  return (\r\n    <div\r\n      className=\"yotpo yotpo-main-widget\"\r\n      data-product-id={sourceProductId}\r\n      data-price={price}\r\n      data-currency={product.price.currencyCode}\r\n      data-name={product.name}\r\n      data-url={`${window.location.origin}${urlPath}`}\r\n      data-image-url={product.images[0].url}\r\n      data-description={product.description}\r\n    />\r\n  );\r\n};\r\n\r\nexport default YotpoReviews;\r\n","import React, { FC, Fragment } from 'react';\r\n\r\nexport type YotpoScriptsProps = {};\r\n\r\nexport type HtmlScript = {\r\n  defer?: boolean;\r\n  async?: boolean;\r\n  src: string;\r\n  type: string;\r\n};\r\n\r\nexport const YOTPO_SCRIPTS: HtmlScript[] = [\r\n  {\r\n    src: `//staticw2.yotpo.com/${process.env.YOTPO_API_KEY}/widget.js`,\r\n    type: 'text/javascript',\r\n    defer: true\r\n  }\r\n];\r\n\r\n/**\r\n * Embeds the Yotpo widget script into the dom\r\n */\r\nconst YotpoScripts: FC<YotpoScriptsProps> = () => {\r\n  return (\r\n    <Fragment>\r\n      {YOTPO_SCRIPTS.map((script) => (\r\n        <script\r\n          key={script.src}\r\n          src={script.src}\r\n          async={script.async}\r\n          defer={script.defer}\r\n          type={script.type}\r\n        ></script>\r\n      ))}\r\n    </Fragment>\r\n  );\r\n};\r\n\r\nexport default YotpoScripts;\r\n"],"names":["decodeProductId","productId","Buffer","from","toString","split","pop","err","console","error","message","useYotpoRefresh","debounceTime","debouncedRefresh","useMemo","func","wait","immediate","timeout","refreshWidgets","window","yotpo","bind","_i","args","context","this","later","apply","callNow","clearTimeout","setTimeout","useEffect","YotpoStarRating","_a","sourceProductId","React","className","YotpoReviews","product","_b","price","_c","urlPath","id","currencyCode","name","location","origin","images","url","description","YOTPO_SCRIPTS","src","process","env","YOTPO_API_KEY","type","defer","YotpoScripts","Fragment","map","script","key","async"],"mappings":"yEAQwBA,EAAgBC,GACtC,IAAKA,EACH,OAAO,KAGT,IACE,OAAOC,OAAOC,KAAKF,EAAW,UAAUG,SAAS,SAASC,MAAM,KAAKC,MACrE,MAAOC,GAEP,OADAC,QAAQC,MAAM,+BAA+BR,EAAaM,EAAIG,SACvD,eCGKC,EAAgBC,gBAAAA,OAC9B,IAAMC,EAAmBC,GAAQ,WAC/B,ICRFC,EACAC,EACAC,EAEIC,EDIIC,EAAiBC,OAAOC,MAC1BD,OAAOC,MAAMF,eAAeG,KAAKF,OAAOC,OACxC,aAEJ,OCZFN,EDYkBI,ECXlBH,EDWkCJ,ECN3B,eAAU,aAAAW,mBAAAA,IAAAC,kBACf,IAAMC,EAAUC,KAEVC,EAAQ,WACZT,EAAU,KACLD,GACHF,EAAKa,MAAMH,EAASD,IAIlBK,EAAUZ,IAAcC,EAE9BY,aAAaZ,GACbA,EAAUa,WAAWJ,EAAOX,GAExBa,GACFd,EAAKa,MAAMH,EAASD,MDTrB,CAACZ,IAEJoB,GAAU,WACc,oBAAXZ,QAA0BA,OAAOC,OAC1CR,MAED,CAACA,QElBAoB,EAA4C,SAACC,OAAEjC,cACnDU,IAEA,IAAMwB,EAAkBrB,GAAQ,WAAM,OAAAd,EAAgBC,KAAY,CAChEA,IAGF,OAAOmC,uBAAKC,UAAU,qCAAoCF,KCPtDG,EAAsC,SAACJ,OAC3CK,YACAC,UAAAC,aAAQ,KACRC,YAAAC,aAAU,KAEVhC,IAEA,IAAMwB,EAAkBrB,GACtB,WAAM,OAAAd,EAAgBuC,EAAQK,GAAGxC,cACjC,CAACmC,EAAQK,KAGX,OACER,uBACEC,UAAU,4CACOF,eACLM,kBACGF,EAAQE,MAAMI,yBAClBN,EAAQO,gBACT,GAAG1B,OAAO2B,SAASC,OAASL,mBACtBJ,EAAQU,OAAO,GAAGC,uBAChBX,EAAQY,eCzBnBC,EAA8B,CACzC,CACEC,IAAK,wBAAwBC,QAAQC,IAAIC,2BACzCC,KAAM,kBACNC,OAAO,IAOLC,EAAsC,WAC1C,OACEvB,gBAACwB,OACER,EAAcS,KAAI,SAACC,GAAW,OAC7B1B,0BACE2B,IAAKD,EAAOT,IACZA,IAAKS,EAAOT,IACZW,MAAOF,EAAOE,MACdN,MAAOI,EAAOJ,MACdD,KAAMK,EAAOL"}